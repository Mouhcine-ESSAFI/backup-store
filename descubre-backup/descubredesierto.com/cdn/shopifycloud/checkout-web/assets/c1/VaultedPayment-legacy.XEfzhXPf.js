!function(){function e(e,n,t,o,r,a,i){try{var l=e[a](i),s=l.value}catch(e){return void t(e)}l.done?n(s):Promise.resolve(s).then(o,r)}System.register(["./app-legacy.CVtZXpP_.js"],(function(n,t){"use strict";var o,r,a,i,l,s,u,c,d,h,m,y,v,p,w,f,P,b,g,S,k,C,_,z,I,M,x,A,E,W,B,O;return{setters:[e=>{o=e.co,r=e.sq,a=e.sr,i=e.i,l=e.ss,s=e.bG,u=e.ct,c=e.a,d=e.aD,h=e.st,m=e.cu,y=e.jT,v=e.su,p=e.gP,w=e.iT,f=e.aM,P=e.iU,b=e.z,g=e.j1,S=e.j2,k=e.k,C=e.sv,_=e.sw,z=e.j3,I=e.sx,M=e.sy,x=e.cD,A=e.cr,E=e.cF,W=e.bn,B=e.sz,O=e.R}],execute:function(){var t=document.createElement("style");function j(){var e,n;const{hasError:t}=o(m),y=r(),v=a(),{i18n:p,telemetryClient:w}=i(),f=p.translate("review.blocks.change_link_label"),P=null===(e=l(null==v||null===(n=v.method)||void 0===n?void 0:n.walletParams))||void 0===e?void 0:e.checkout_session_id,{inMemoryAmazonPayParts:{hasPaymentSheetError:b}}=s();return v?y.status!==u.Available?null:c(d,{onClick:()=>{try{y.sdk.buywithprime.changePaymentMethod({amazonPayOptions:{amazonCheckoutSessionId:P,isDeclined:t}})}catch(e){b.value=!0,w.error(new h(`Error on changing buyer payment method. Details: ${e}`,{cause:e}))}},children:f}):null}t.textContent=".oZdJX>*{display:flex;height:inherit;width:inherit}.oZdJX{overflow:hidden}\n/*$vite$:1*/",document.head.appendChild(t),n("P",T);class D extends Error{constructor(...e){var n,t,o;super(...e),n=this,o="PortableWalletsSandboxError",(t=function(e){var n=function(e){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var t=n.call(e,"string");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof n?n:n+""}(t="name"))in n?Object.defineProperty(n,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[t]=o}}const U={PortableWalletsPCIButton:"oZdJX"};function T({wallet:n,isSdkOnly:t=!1}){const{i18n:o,shop:r,source:a,environment:l,telemetryClient:d}=i(),{id:h}=r,{value:m}=y(),{countryCode:M,presentmentCurrency:x}=null!=m?m:{},A=v(n),E=null==A?void 0:A.configurationParams,W=p(null),{isScrimOpen:B,closePopupWindowsAndScrim:O}=w({endpoint:W,invokingWallet:n}),{inMemoryAmazonPayParts:{buttonStatus:j,sdkStatus:T}}=s(),F=f(null),X=f(null),$=P(),q=b((({errorMessage:e})=>d.error(new D(e))),[d]),J=p(!1),L=b(function(){var o,r=(o=function*(e){T.value={status:u.Loading};const o=yield e.call.configure({configurationParams:E,buyerCountry:M,buyerCurrency:x,shopId:h,cartId:a.sourceId,onlySdk:t,service:l.services.portableWallets});(null==o?void 0:o.status)===g.Success?(T.value=function(e,n){return{status:u.Available,sdk:{buywithprime:{changePaymentMethod:({amazonPayOptions:t})=>{var o;if(!t.amazonCheckoutSessionId)throw new D("Missing amazonCheckoutSessionId");null===(o=n.value)||void 0===o||o.call.changePaymentMethod({wallet:e,changePaymentParams:{amazonCheckoutSessionId:t.amazonCheckoutSessionId,isDeclined:t.isDeclined}})},changeShippingAddress:({amazonCheckoutSessionId:t})=>{var o;if(!t)throw new D("Missing amazonCheckoutSessionId");null===(o=n.value)||void 0===o||o.call.changeShippingAddress({wallet:e,changeShippingParams:{amazonCheckoutSessionId:t}})},initCheckout:()=>{throw new D('Unexpected invocation of "initCheckout"')},renderButton:()=>{throw new D('Unexpected invocation of "renderButton"')}},Pay:{changePaymentMethod:()=>{throw new D('Unexpected invocation of AmazonPay "changePaymentMethod" in BWP flow')},changeShippingAddress:()=>{throw new D('Unexpected invocation of AmazonPay "changeShippingAddress" in BWP flow')},initCheckout:()=>{throw new D('Unexpected invocation of AmazonPay "initCheckout" in BWP flow')},renderButton:()=>{throw new D('Unexpected invocation of AmazonPay "renderButton" in BWP flow')}}}}}(n,W),t||(j.value={status:"rendered"},d.counter({name:"checkout_wallet_button_rendered",value:1,attributes:{wallet_name:n,status:"success",isPaymentMethodFlow:!1}}))):((null==o?void 0:o.status)===g.Error&&q({errorMessage:null==o?void 0:o.message}),T.value={status:u.Error},t||(j.value={status:"error"},d.counter({name:"checkout_wallet_button_rendered",value:1,attributes:{wallet_name:n,status:"error",isPaymentMethodFlow:!1}})))},function(){var n=this,t=arguments;return new Promise((function(r,a){var i=o.apply(n,t);function l(n){e(i,r,a,l,s,"next",n)}function s(n){e(i,r,a,l,s,"throw",n)}l(void 0)}))});return function(e){return r.apply(this,arguments)}}(),[E,M,h,x,a.sourceId,t,n,q,T,j,W,l,d]);J.value&&null!=m&&m.countryCode&&null!=m&&m.presentmentCurrency&&W.value&&(J.value=!1,L(W.value));const N=S(),Z=k((()=>({clicked:e=>{var n,t,o;B.value=!0,$(X),e&&(n=e.skus,t=e.apiClientId,null!==(o=window.Shopify)&&void 0!==o&&null!==(o=o.analytics)&&void 0!==o&&o.publish&&(window.Shopify.analytics.publish(`shopify:app:pixels:load:${t}`,{},{sendTo:"PIXEL-LOADER"}),window.Shopify.analytics.publish("bwp_checkout_widget_click",{skus:n},{sendTo:t})))},closed:()=>B.value=!1,redirect:({redirectUrl:e,requestPayload:n})=>{try{if(n){if(!F.current)return void d.error(new C("Form container not found",{groupingHash:"AmazonPaySandboxError::PortableWalletsPCIButton::FormContainerNotFound"}));_({formContainer:F.current,url:e,requestPayload:n}).submit()}else window.location.assign(e)}catch(t){d.error(t)}},reportError:q,telemetry:N})),[B,q,d,$,N]);return c("div",{className:U.PortableWalletsPCIButton,children:[c("div",{ref:F,style:{display:"none"}}),c(z,{wallet:n,onConnect:e=>{W.value=e,J.value=!0},onTerminate:()=>W.value=null,hostMethods:Z,isSdkOnly:t,ref:X}),c(I,{isOpen:B.value,walletName:o.translate("brand.buy_with_prime"),handleClose:O})]})}const F=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const{i18n:e}=i(),{brand:n,descriptor:t}=M(),o=x(),r=!t||!o;return c(O,{children:[c(T,{wallet:A.BuyWithPrime,isSdkOnly:!0}),c(E,{id:"buyWithPrimePayDetails",label:e.translate("payment.payment_method"),summary:r?c(W,{}):c(B,{brand:n,descriptor:t}),action:c(j,{})})]})}},Symbol.toStringTag,{value:"Module"}));n("V",F)}}}))}();
